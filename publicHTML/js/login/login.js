"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Login = void 0;

var _jxhelper = require("/js/helper/jxhelper.js");

var _fetchHelper = require("/js/helper/fetchHelper.js");

class Login {
  //show login page
  static renderLoginPage() {
    //empty main-content child elements
    const mainContent = _jxhelper.JxHelper.getMainContent();

    _jxhelper.JxHelper.emptyElementChildren(mainContent);

    _jxhelper.JxHelper.getSpecialLoading().innerText = 'redirecting to login page...';

    _jxhelper.JxHelper.showSpecialLoading();

    _fetchHelper.FetchHelper.text('/js/login/partial.html').then(text => {
      _jxhelper.JxHelper.getSpecialContent().innerHTML = text; //setup event handler

      Login.setupEventHandler();

      _jxhelper.JxHelper.showSpecialContent();

      _jxhelper.JxHelper.hideSpecialLoading();

      setTimeout(function () {
        const xx = document.querySelector('.login-placeholder');
        xx.classList.add('show-login');
      }, 100);
    }).catch(err => {
      console.error(err);

      _jxhelper.JxHelper.showServerErrorMessage();
    });
  }

  static setupEventHandler() {
    //implement event handler
    const form = document.querySelector('#loginForm');
    form.addEventListener('submit', e => {
      console.log('entering login form submit handler...');
      var jsonData = {
        username: document.querySelector('#usernameCtl').value,
        pwd: document.querySelector('#pwdCtl').value
      };
      var loginMsg = document.querySelector('#loginFailMsg');
      loginMsg.classList.remove('text-danger');
      loginMsg.innerHTML = "try login...";
      console.log('start send POST request');

      _fetchHelper.FetchHelper.postJson('/api/login', jsonData).then(responseJson => {
        if (responseJson.statusCode === 0) {
          loginMsg.innerHTML = "login success";
          window.location = "/"; //redirect to default page
        } else {
          loginMsg.innerHTML = responseJson.statusMsg;
          loginMsg.classList.add('text-danger');
        }
      }).catch(err => {
        console.error("failed to login: ".concat(err.message));

        _jxhelper.JxHelper.showServerErrorMessage();
      });

      e.preventDefault();
    });
  }

  static logout() {
    //handle logout
    _fetchHelper.FetchHelper.postJson('/api/logout', {}).then(jsonData => {
      if (jsonData.statusCode === 0) {
        //logout success
        window.location = "#login";
      } else {
        //logout failed
        console.error(jsonData.statusMsg);

        const specialError = _jxhelper.JxHelper.getSpecialError();

        specialError.innerHTML = "<h3>opps, failed to logout...</h3><p>".concat(jsonData.statusMsg, "</p>");

        _jxhelper.JxHelper.showSpecialError();
      }
    }).catch(err => {
      console.error("failed to logout: ".concat(err.message));

      _jxhelper.JxHelper.showServerErrorMessage();
    });
  }

} //# sourceURL=login/login.js


exports.Login = Login;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2NsaWVudC9qcy9sb2dpbi9sb2dpbi5qcyJdLCJuYW1lcyI6WyJMb2dpbiIsInJlbmRlckxvZ2luUGFnZSIsIm1haW5Db250ZW50IiwiSnhIZWxwZXIiLCJnZXRNYWluQ29udGVudCIsImVtcHR5RWxlbWVudENoaWxkcmVuIiwiZ2V0U3BlY2lhbExvYWRpbmciLCJpbm5lclRleHQiLCJzaG93U3BlY2lhbExvYWRpbmciLCJGZXRjaEhlbHBlciIsInRleHQiLCJ0aGVuIiwiZ2V0U3BlY2lhbENvbnRlbnQiLCJpbm5lckhUTUwiLCJzZXR1cEV2ZW50SGFuZGxlciIsInNob3dTcGVjaWFsQ29udGVudCIsImhpZGVTcGVjaWFsTG9hZGluZyIsInNldFRpbWVvdXQiLCJ4eCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNsYXNzTGlzdCIsImFkZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwic2hvd1NlcnZlckVycm9yTWVzc2FnZSIsImZvcm0iLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImxvZyIsImpzb25EYXRhIiwidXNlcm5hbWUiLCJ2YWx1ZSIsInB3ZCIsImxvZ2luTXNnIiwicmVtb3ZlIiwicG9zdEpzb24iLCJyZXNwb25zZUpzb24iLCJzdGF0dXNDb2RlIiwid2luZG93IiwibG9jYXRpb24iLCJzdGF0dXNNc2ciLCJtZXNzYWdlIiwicHJldmVudERlZmF1bHQiLCJsb2dvdXQiLCJzcGVjaWFsRXJyb3IiLCJnZXRTcGVjaWFsRXJyb3IiLCJzaG93U3BlY2lhbEVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBRU8sTUFBTUEsS0FBTixDQUFZO0FBRWY7QUFDQSxTQUFPQyxlQUFQLEdBQXlCO0FBQ3JCO0FBQ0EsVUFBTUMsV0FBVyxHQUFHQyxtQkFBU0MsY0FBVCxFQUFwQjs7QUFDQUQsdUJBQVNFLG9CQUFULENBQThCSCxXQUE5Qjs7QUFFQUMsdUJBQVNHLGlCQUFULEdBQTZCQyxTQUE3QixHQUF5Qyw4QkFBekM7O0FBQ0FKLHVCQUFTSyxrQkFBVDs7QUFFQUMsNkJBQVlDLElBQVosQ0FBaUIsd0JBQWpCLEVBQ0tDLElBREwsQ0FDVUQsSUFBSSxJQUFJO0FBQ1ZQLHlCQUFTUyxpQkFBVCxHQUE2QkMsU0FBN0IsR0FBeUNILElBQXpDLENBRFUsQ0FHVjs7QUFDQVYsTUFBQUEsS0FBSyxDQUFDYyxpQkFBTjs7QUFFQVgseUJBQVNZLGtCQUFUOztBQUNBWix5QkFBU2Esa0JBQVQ7O0FBRUFDLE1BQUFBLFVBQVUsQ0FBQyxZQUFXO0FBQ2xCLGNBQU1DLEVBQUUsR0FBR0MsUUFBUSxDQUFDQyxhQUFULENBQXVCLG9CQUF2QixDQUFYO0FBQ0FGLFFBQUFBLEVBQUUsQ0FBQ0csU0FBSCxDQUFhQyxHQUFiLENBQWlCLFlBQWpCO0FBQ0gsT0FIUyxFQUdQLEdBSE8sQ0FBVjtBQUlILEtBZEwsRUFlS0MsS0FmTCxDQWVXQyxHQUFHLElBQUk7QUFDVkMsTUFBQUEsT0FBTyxDQUFDQyxLQUFSLENBQWNGLEdBQWQ7O0FBQ0FyQix5QkFBU3dCLHNCQUFUO0FBQ0gsS0FsQkw7QUFtQkg7O0FBRUQsU0FBT2IsaUJBQVAsR0FBMkI7QUFDdkI7QUFDQSxVQUFNYyxJQUFJLEdBQUdULFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixZQUF2QixDQUFiO0FBRUFRLElBQUFBLElBQUksQ0FBQ0MsZ0JBQUwsQ0FBc0IsUUFBdEIsRUFBZ0NDLENBQUMsSUFBSTtBQUNqQ0wsTUFBQUEsT0FBTyxDQUFDTSxHQUFSLENBQVksdUNBQVo7QUFFQSxVQUFJQyxRQUFRLEdBQUc7QUFDWEMsUUFBQUEsUUFBUSxFQUFFZCxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsY0FBdkIsRUFBdUNjLEtBRHRDO0FBRVhDLFFBQUFBLEdBQUcsRUFBRWhCLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixTQUF2QixFQUFrQ2M7QUFGNUIsT0FBZjtBQUtBLFVBQUlFLFFBQVEsR0FBR2pCLFFBQVEsQ0FBQ0MsYUFBVCxDQUF1QixlQUF2QixDQUFmO0FBQ0FnQixNQUFBQSxRQUFRLENBQUNmLFNBQVQsQ0FBbUJnQixNQUFuQixDQUEwQixhQUExQjtBQUNBRCxNQUFBQSxRQUFRLENBQUN2QixTQUFULEdBQW9CLGNBQXBCO0FBRUFZLE1BQUFBLE9BQU8sQ0FBQ00sR0FBUixDQUFZLHlCQUFaOztBQUNBdEIsK0JBQVk2QixRQUFaLENBQXFCLFlBQXJCLEVBQW1DTixRQUFuQyxFQUNLckIsSUFETCxDQUNVNEIsWUFBWSxJQUFJO0FBQ2xCLFlBQUlBLFlBQVksQ0FBQ0MsVUFBYixLQUE0QixDQUFoQyxFQUFtQztBQUMvQkosVUFBQUEsUUFBUSxDQUFDdkIsU0FBVCxHQUFxQixlQUFyQjtBQUVBNEIsVUFBQUEsTUFBTSxDQUFDQyxRQUFQLEdBQWtCLEdBQWxCLENBSCtCLENBR1I7QUFDMUIsU0FKRCxNQUlPO0FBQ0hOLFVBQUFBLFFBQVEsQ0FBQ3ZCLFNBQVQsR0FBcUIwQixZQUFZLENBQUNJLFNBQWxDO0FBQ0FQLFVBQUFBLFFBQVEsQ0FBQ2YsU0FBVCxDQUFtQkMsR0FBbkIsQ0FBdUIsYUFBdkI7QUFDSDtBQUNKLE9BVkwsRUFXS0MsS0FYTCxDQVdXQyxHQUFHLElBQUk7QUFDVkMsUUFBQUEsT0FBTyxDQUFDQyxLQUFSLDRCQUFrQ0YsR0FBRyxDQUFDb0IsT0FBdEM7O0FBQ0F6QywyQkFBU3dCLHNCQUFUO0FBQ0gsT0FkTDs7QUFnQkFHLE1BQUFBLENBQUMsQ0FBQ2UsY0FBRjtBQUNILEtBOUJEO0FBK0JIOztBQUVELFNBQU9DLE1BQVAsR0FBZ0I7QUFDWjtBQUNBckMsNkJBQVk2QixRQUFaLENBQXFCLGFBQXJCLEVBQW9DLEVBQXBDLEVBQ0szQixJQURMLENBQ1VxQixRQUFRLElBQUk7QUFDZCxVQUFJQSxRQUFRLENBQUNRLFVBQVQsS0FBd0IsQ0FBNUIsRUFBK0I7QUFDM0I7QUFDQUMsUUFBQUEsTUFBTSxDQUFDQyxRQUFQLEdBQWtCLFFBQWxCO0FBQ0gsT0FIRCxNQUdPO0FBQ0g7QUFDQWpCLFFBQUFBLE9BQU8sQ0FBQ0MsS0FBUixDQUFjTSxRQUFRLENBQUNXLFNBQXZCOztBQUVBLGNBQU1JLFlBQVksR0FBRzVDLG1CQUFTNkMsZUFBVCxFQUFyQjs7QUFDQUQsUUFBQUEsWUFBWSxDQUFDbEMsU0FBYixrREFDNENtQixRQUFRLENBQUNXLFNBRHJEOztBQUVBeEMsMkJBQVM4QyxnQkFBVDtBQUNIO0FBQ0osS0FkTCxFQWVLMUIsS0FmTCxDQWVXQyxHQUFHLElBQUc7QUFDVEMsTUFBQUEsT0FBTyxDQUFDQyxLQUFSLDZCQUFtQ0YsR0FBRyxDQUFDb0IsT0FBdkM7O0FBQ0F6Qyx5QkFBU3dCLHNCQUFUO0FBQ0gsS0FsQkw7QUFtQkg7O0FBMUZjLEMsQ0E0Rm5CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSnhIZWxwZXIgfSBmcm9tICcvanMvaGVscGVyL2p4aGVscGVyLmpzJ1xyXG5pbXBvcnQgeyBGZXRjaEhlbHBlciB9IGZyb20gJy9qcy9oZWxwZXIvZmV0Y2hIZWxwZXIuanMnXHJcblxyXG5leHBvcnQgY2xhc3MgTG9naW4ge1xyXG5cclxuICAgIC8vc2hvdyBsb2dpbiBwYWdlXHJcbiAgICBzdGF0aWMgcmVuZGVyTG9naW5QYWdlKCkge1xyXG4gICAgICAgIC8vZW1wdHkgbWFpbi1jb250ZW50IGNoaWxkIGVsZW1lbnRzXHJcbiAgICAgICAgY29uc3QgbWFpbkNvbnRlbnQgPSBKeEhlbHBlci5nZXRNYWluQ29udGVudCgpXHJcbiAgICAgICAgSnhIZWxwZXIuZW1wdHlFbGVtZW50Q2hpbGRyZW4obWFpbkNvbnRlbnQpXHJcblxyXG4gICAgICAgIEp4SGVscGVyLmdldFNwZWNpYWxMb2FkaW5nKCkuaW5uZXJUZXh0ID0gJ3JlZGlyZWN0aW5nIHRvIGxvZ2luIHBhZ2UuLi4nXHJcbiAgICAgICAgSnhIZWxwZXIuc2hvd1NwZWNpYWxMb2FkaW5nKClcclxuXHJcbiAgICAgICAgRmV0Y2hIZWxwZXIudGV4dCgnL2pzL2xvZ2luL3BhcnRpYWwuaHRtbCcpXHJcbiAgICAgICAgICAgIC50aGVuKHRleHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgSnhIZWxwZXIuZ2V0U3BlY2lhbENvbnRlbnQoKS5pbm5lckhUTUwgPSB0ZXh0XHJcblxyXG4gICAgICAgICAgICAgICAgLy9zZXR1cCBldmVudCBoYW5kbGVyXHJcbiAgICAgICAgICAgICAgICBMb2dpbi5zZXR1cEV2ZW50SGFuZGxlcigpXHJcblxyXG4gICAgICAgICAgICAgICAgSnhIZWxwZXIuc2hvd1NwZWNpYWxDb250ZW50KClcclxuICAgICAgICAgICAgICAgIEp4SGVscGVyLmhpZGVTcGVjaWFsTG9hZGluZygpXHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB4eCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2dpbi1wbGFjZWhvbGRlcicpXHJcbiAgICAgICAgICAgICAgICAgICAgeHguY2xhc3NMaXN0LmFkZCgnc2hvdy1sb2dpbicpXHJcbiAgICAgICAgICAgICAgICB9LCAxMDApXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpXHJcbiAgICAgICAgICAgICAgICBKeEhlbHBlci5zaG93U2VydmVyRXJyb3JNZXNzYWdlKClcclxuICAgICAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgc2V0dXBFdmVudEhhbmRsZXIoKSB7XHJcbiAgICAgICAgLy9pbXBsZW1lbnQgZXZlbnQgaGFuZGxlclxyXG4gICAgICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbG9naW5Gb3JtJylcclxuXHJcbiAgICAgICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBlID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2VudGVyaW5nIGxvZ2luIGZvcm0gc3VibWl0IGhhbmRsZXIuLi4nKVxyXG5cclxuICAgICAgICAgICAgdmFyIGpzb25EYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VybmFtZUN0bCcpLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgcHdkOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHdkQ3RsJykudmFsdWVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGxvZ2luTXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvZ2luRmFpbE1zZycpXHJcbiAgICAgICAgICAgIGxvZ2luTXNnLmNsYXNzTGlzdC5yZW1vdmUoJ3RleHQtZGFuZ2VyJylcclxuICAgICAgICAgICAgbG9naW5Nc2cuaW5uZXJIVE1MID1cInRyeSBsb2dpbi4uLlwiXHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhcnQgc2VuZCBQT1NUIHJlcXVlc3QnKVxyXG4gICAgICAgICAgICBGZXRjaEhlbHBlci5wb3N0SnNvbignL2FwaS9sb2dpbicsIGpzb25EYXRhKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2VKc29uID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VKc29uLnN0YXR1c0NvZGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5Nc2cuaW5uZXJIVE1MID0gXCJsb2dpbiBzdWNjZXNzXCJcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL1wiOyAvL3JlZGlyZWN0IHRvIGRlZmF1bHQgcGFnZVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luTXNnLmlubmVySFRNTCA9IHJlc3BvbnNlSnNvbi5zdGF0dXNNc2dcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5Nc2cuY2xhc3NMaXN0LmFkZCgndGV4dC1kYW5nZXInKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBmYWlsZWQgdG8gbG9naW46ICR7ZXJyLm1lc3NhZ2V9YClcclxuICAgICAgICAgICAgICAgICAgICBKeEhlbHBlci5zaG93U2VydmVyRXJyb3JNZXNzYWdlKClcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBsb2dvdXQoKSB7XHJcbiAgICAgICAgLy9oYW5kbGUgbG9nb3V0XHJcbiAgICAgICAgRmV0Y2hIZWxwZXIucG9zdEpzb24oJy9hcGkvbG9nb3V0Jywge30pXHJcbiAgICAgICAgICAgIC50aGVuKGpzb25EYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChqc29uRGF0YS5zdGF0dXNDb2RlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9sb2dvdXQgc3VjY2Vzc1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiI2xvZ2luXCJcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9sb2dvdXQgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihqc29uRGF0YS5zdGF0dXNNc2cpXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwZWNpYWxFcnJvciA9IEp4SGVscGVyLmdldFNwZWNpYWxFcnJvcigpXHJcbiAgICAgICAgICAgICAgICAgICAgc3BlY2lhbEVycm9yLmlubmVySFRNTCA9IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBgPGgzPm9wcHMsIGZhaWxlZCB0byBsb2dvdXQuLi48L2gzPjxwPiR7anNvbkRhdGEuc3RhdHVzTXNnfTwvcD5gXHJcbiAgICAgICAgICAgICAgICAgICAgSnhIZWxwZXIuc2hvd1NwZWNpYWxFcnJvcigpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT57XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBmYWlsZWQgdG8gbG9nb3V0OiAke2Vyci5tZXNzYWdlfWApXHJcbiAgICAgICAgICAgICAgICBKeEhlbHBlci5zaG93U2VydmVyRXJyb3JNZXNzYWdlKClcclxuICAgICAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG4vLyMgc291cmNlVVJMPWxvZ2luL2xvZ2luLmpzIl19